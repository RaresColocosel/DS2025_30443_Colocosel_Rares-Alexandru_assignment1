http:
  routers:
    # 1. Frontend Router (Catch-all except /api)
    frontend-web:
      rule: "Host(`localhost`) && PathPrefix(`/`) && !PathPrefix(`/api`)"
      entryPoints:
        - web
      priority: 1
      service: frontend-svc

    # 2. Auth API
    auth-api:
      rule: "Host(`localhost`) && PathPrefix(`/api/auth`)"
      entryPoints:
        - web
      middlewares:
        - strip-api-prefix
      service: auth-svc

    # 3. User API
    user-api:
      rule: "Host(`localhost`) && (PathPrefix(`/api/users`) || PathPrefix(`/api/me`) || PathPrefix(`/api/client`))"
      entryPoints:
        - web
      middlewares:
        - strip-api-prefix
      service: user-svc

    # 4. Device API
    device-api:
      rule: "Host(`localhost`) && (PathPrefix(`/api/devices`) || PathPrefix(`/api/assignments`))"
      entryPoints:
        - web
      middlewares:
        - strip-api-prefix
      service: device-svc

    # 5. Monitoring API (Routes /api/monitoring -> /monitoring on backend)
    monitoring-api:
      rule: "Host(`localhost`) && PathPrefix(`/api/monitoring`)"
      entryPoints:
        - web
      middlewares:
        - strip-api-prefix
      service: monitoring-svc

  middlewares:
    strip-api-prefix:
      stripPrefix:
        prefixes:
          - "/api"

  services:
    auth-svc:
      loadBalancer:
        servers:
          - url: "http://auth-service:8080"
    user-svc:
      loadBalancer:
        servers:
          - url: "http://user-service:8080"
    device-svc:
      loadBalancer:
        servers:
          - url: "http://device-service:8080"
    monitoring-svc:
      loadBalancer:
        servers:
          - url: "http://monitoring-service:8080"
    frontend-svc:
      loadBalancer:
        servers:
          - url: "http://frontend:5173"